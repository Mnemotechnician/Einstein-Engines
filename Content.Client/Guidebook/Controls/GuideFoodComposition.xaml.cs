using System.Linq;
using Content.Client.Chemistry.EntitySystems;
using Content.Client.Message;
using Content.Client.UserInterface.ControlExtensions;
using Content.Shared.Atmos.Prototypes;
using Content.Shared.Chemistry.Components;
using Content.Shared.Chemistry.Reaction;
using Content.Shared.Chemistry.Reagent;
using Content.Shared.FixedPoint;
using Content.Shared.Kitchen;
using Content.Shared.Localizations;
using JetBrains.Annotations;
using Robust.Client.AutoGenerated;
using Robust.Client.GameObjects;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Graphics.RSI;
using Robust.Shared.Prototypes;
using Robust.Shared.Utility;

namespace Content.Client.Guidebook.Controls;

[UsedImplicitly, GenerateTypedNameReferences]
public sealed partial class GuideFoodComposition : BoxContainer, ISearchableControl
{
    public GuideFoodComposition(IPrototypeManager protoMan, ReagentQuantity quantity)
    {
        RobustXamlLoader.Load(this);

        if (!protoMan.TryIndex<ReagentPrototype>(quantity.Reagent.Prototype, out var reagent))
        {
            ReagentLabel.Text = Loc.GetString("guidebook-food-unknown-proto", ("id", quantity.Reagent.Prototype));
            return;
        }

        ReagentLabel.Text = reagent.LocalizedName;
        AmountLabel.Text = quantity.Quantity.ToString();
    }

    public bool CheckMatchesSearch(string query)
    {
        return this.ChildrenContainText(query);
    }

    public void SetHiddenState(bool state, string query)
    {
        Visible = CheckMatchesSearch(query) ? state : !state;
    }
}
